<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mini Library Management System</title>
   <!-- AFTER -->
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
    /* Add this to your existing CSS */
    @media (max-width: 768px) {
        .flex { flex-direction: column; gap: 20px; }
        .panel { min-width: auto; }
        nav ul { flex-direction: column; align-items: center; gap: 10px; }
    }
    /* --- Part 1: Structure and Styling --- */
    body {
        font-family: 'Segoe UI', sans-serif;
        background: #f4f6fa;
        margin: 0;
    }
    h1 {
        text-align: center;
        color: #2d3e50;
        margin-top: 20px;
    }
    .container, .login-panel {
        max-width: 1100px;
        margin: 30px auto;
        background: #fff;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 12px #0001;
    }
    .flex {
        display: flex;
        gap: 40px;
        flex-wrap: wrap;
    }
    .panel {
        flex: 1 1 350px;
        min-width: 300px;
    }
    button {
        background: #2d3e50;
        color: #fff;
        padding: 7px 12px;
        border-radius: 5px;
        cursor: pointer;
        transition: background 0.2s;
    }
    button:hover {
        background: #1a2533;
    }
    .notification {
        padding: 10px;
        border-radius: 5px;
        display: none;
        margin: 10px 0;
        color: #fff;
    }
    .notification.success { background: #4caf50; }
    .notification.error { background: #e53935; }
    /* Add to your styles */
    body { background: #f4f6fa; color: #2d3e50; }
    button { background: #2d3e50; color: #fff; }
    .notification.success { background: #4caf50; color: #fff; }
    .notification.error { background: #e53935; color: #fff; }

</style>

<!-- Inside the flex container (add to the previous flex div) -->
<div class="panel">Panel 1</div>
<div class="panel">Panel 2</div>
<!-- Add more panels as needed -->

</head>
<body>
    <!-- AFTER -->
<nav>
    <ul style="list-style: none; padding: 0; display: flex; gap: 20px; justify-content: center; background: #2d3e50; color: #fff; padding: 15px 0;">
        <li><a href="#" style="text-decoration: none; color: #fff;">Home</a></li>
        <li><a href="#" style="text-decoration: none; color: #fff;">Books</a></li>
        <li><a href="#" style="text-decoration: none; color: #fff;">My Account</a></li>
    </ul>
</nav>
<!-- AFTER -->

<h1><span role="img" aria-label="Books">ðŸ“š</span> Mini Library Management System</h1>
<!-- For images: <img src="book.png" alt="Book icon"> -->
<!-- (Also check color contrast in CSS) -->
    <!-- Login Section -->
<div id="loginSection" class="login-panel">
    <h2>Login</h2>
    <input type="text" id="loginName" placeholder="Enter your name">
    <button onclick="loginUser()" style="width: 100%; margin-top: 10px;">Login to Manage Books</button>
    <div id="loginNotification" class="notification"></div>
</div>
<!-- Main Section -->
<div class="container" id="mainSection">
<!-- AFTER -->
<div id="userWelcome" style="font-size: 1.2em; font-weight: bold; color: #2d3e50; margin-bottom: 20px;"></div>
<button onclick="logoutUser()" style="float:right; background: #e53935;">SignÂ Out</button>
    <div id="mainNotification" class="notification"></div>
    <div class="flex">
        <!-- Panels will go here in next commit -->
    </div>
</div>

<!-- User Panel -->
<div class="panel">
    <h2>Users</h2>
    <input type="text" id="userName" placeholder="Enter user name">
    <button onclick="addUser()">Add User</button>
    <ul id="userList"></ul>
</div>
<script>
    // User Authentication
async function loginUser() {
    const name = document.getElementById('loginName').value.trim();
    if (!name) return alert('Enter your name');
    await fetch('/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({name})
    });
    checkLogin();
}

async function logoutUser() {
    await fetch('/logout', {method: 'POST'});
    checkLogin();
}

async function checkLogin() {
    const response = await fetch('/session');
    const data = await response.json();
    if (data.logged_in) {
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('mainSection').style.display = '';
    } else {
        document.getElementById('loginSection').style.display = '';
        document.getElementById('mainSection').style.display = 'none';
    }
}
// User Management
async function addUser() {
    const name = document.getElementById('userName').value.trim();
    if (!name) return alert('Name required');
    


    await fetch('/users', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({name})
    });
    fetchUsers();
}

async function fetchUsers() {
    const res = await fetch('/users');
    const users = await res.json();
    const userList = document.getElementById('userList');
    userList.innerHTML = '';
    users.forEach(u => {
        // In fetchUsers():
users.forEach(u => {
    const li = document.createElement('li');
    li.textContent = u.name;  // Safe text injection
    userList.appendChild(li);
});

    });
}

</script>

<!-- Borrow/Return Panel -->
<div class="panel">
    <h2>Borrow/Return</h2>
    <button onclick="borrowBook()">Borrow</button>
    <button onclick="returnBook()">Return</button>
</div>
<!-- Transactions Panel -->
<div class="panel">
    <h2>Transactions</h2>
    <div id="transactionList"></div>
</div>
<script>
async function borrowBook() {
    try {
        const response = await fetch('/borrow', {method: 'POST'});
        if (!response.ok) throw new Error('Failed to borrow book');
        fetchTransactions();
    } catch (error) {
        alert(error.message);
    }
}
async function returnBook() {
    try {
        const response = await fetch('/return', {method: 'POST'});
        if (!response.ok) throw new Error('Failed to return book');
        fetchTransactions();
    } catch (error) {
        alert(error.message);
    }
}
async function fetchTransactions() {
    try {
        const res = await fetch('/transactions');
        if (!res.ok) throw new Error('Failed to fetch transactions');
        const txs = await res.json();
        const transactionList = document.getElementById('transactionList');
        transactionList.innerHTML = txs.map(tx => <p>${tx.action} - ${tx.date}</p>).join('');
    } catch (error) {
        document.getElementById('transactionList').innerHTML = <p style="color: red;">${error.message}</p>;
    }
}
</script>